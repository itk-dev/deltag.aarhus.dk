{#
/**
 * @file
 * Hearing tickets loading block template.
 *
 * Available variables:
 * - node: The hearing node
 * - is_loading: false iff tickets have not been loaded.
 * - tickets: List of tickets
 * - configuration
 *   - container_id: All content must be wrapped in an element with this as id.
 */
#}

<div id="{{ configuration.container_id }}">
  <div class="row">
    <div class="col">
      {% if is_loading %}
        <h1>{{ 'Loading tickets for %title%'|trans({'%title%': node.title.value}) }}</h1>
      {% else %}
        <h1>{{ 'Hearing tickets (@count)'|trans({'@count': tickets|length}) }}</h1>
      {% endif %}
    </div>
    <div class="col">
      <div class="float-right">
        <a href="{{ path('hoeringsportal_deskpro.hearing.ticket_add', {node: node.id}) }}" class="btn btn-primary">
          {{ 'Add hearing ticket'|trans }}
        </a>
      </div>
    </div>
  </div>

  {% if not is_loading and tickets %}
    {% for index, ticket in tickets %}
      <div class="hearing-ticket">
          <div class="header">
            {{ 'Answer @number by @name'|trans({'@number': index+1, '@name': ticket.person.display_name}) }}
            | <span class="ticket-date_created">{{ ticket.date_created|date('Y-m-d H:i:s') }}</span>
          </div>
          <div class="teaser">
            {% if ticket.messages and ticket.messages|length > 0 %}
              {% set message = ticket.messages[0] %}
              {{ message.message_preview_text }}
            {% endif %}
          </div>
          <div class="read-more">
            <a class="read-more" href="{{ path('hoeringsportal_deskpro.hearing.ticket_view', {node: node.id, ticket: ticket.id}) }}">Details</a>
          </div>
        </div>

      </div>
    {% endfor %}
  {% endif %}
</div>

<div class="hearing-tickets">
  <div class="row mb-3">
    <div class="col">
      <h3>Høringssvar <span v-if="tickets">({{ tickets.length }})</span></h3>
      <div><label>Svarfrist:</label> <strong>{{ deadline }}</strong></div>
    </div>
    <div class="col" v-if="ticket_add_url">
      <div class="float-right">
        <a :href="ticket_add_url" class="btn btn-primary">
          Skriv et nyt høringssvar →
        </a>
      </div>
    </div>
  </div>

  <div class="loading" v-if="loading">{{ $t('Loading tickets …') }}</div>

  <div v-if="tickets" class="bg-light mb-3 ticket" v-for="(ticket, index) in tickets" v-bind:key="ticket.id">
    <a :href="ticket['@details_url']" class="card">
      <div class="card-header">{{ ticket.subject }}</div>
      <div class="card-body pb-0 pt-0">abc</div>
      <div class="card-footer">
        {{ $t('Answer #{number} by {name}', {number: index+1, name: ticket.person.display_name}) }}
        | <span class="ticket-date_created">{{ $d(new Date(ticket.date_created), 'short') }}</span>

        <i class="fa fa-arrow-right float-right"></i>
      </div>
    </a>
  </div>
</div>