{#
/**
 * @file
 * Hearing tickets loading block template.
 *
 * Available variables:
 * - node: The hearing node
 * - is_loading: false iff tickets have not been loaded.
 * - tickets: List of tickets
 * - configuration
 *   - container_id: All content must be wrapped in an element with this as id.
 */
#}

<div id="{{ configuration.container_id }}">
  <div class="row">
    <div class="col">
      {% if is_loading %}
        <div>{{ 'Loading tickets for %title%'|trans({'%title%': node.title.value}) }}</div>
      {% else %}
        <h1>{{ 'Hearing tickets (@count)'|trans({'@count': tickets|length}) }}</h1>
      {% endif %}
    </div>
    <div class="col">
      <div class="float-right">
        <a href="{{ path('hoeringsportal_deskpro.hearing.ticket_add', {node: node.id}) }}" class="btn btn-primary">
          {{ 'Add hearing ticket'|trans }}
        </a>
      </div>
    </div>
  </div>

  {% if not is_loading and tickets %}
    {% for index, ticket in tickets %}
      <a href="{{ path('hoeringsportal_deskpro.hearing.ticket_view', {node: node.id, ticket: ticket.id}) }}" class="hearing-ticket card">
        <h2 class="card-header">
          {{ ticket.subject }}
        </h2>
        <div class="card-body">
          {% if ticket.messages and ticket.messages|length > 0 %}
            {% set message = ticket.messages[0] %}
            {{ message.message_preview_text }}
          {% endif %}
        </div>
        <div class="card-footer">
          {{ 'Answer @number by @name'|trans({'@number': index+1, '@name': ticket.person.display_name}) }}
          | <span class="ticket-date_created">{{ ticket.date_created|date('Y-m-d H:i:s') }}</span>
          <i class="fa fa-arrow-right float-right"></i>
        </div>
      </a>
    {% endfor %}
  {% endif %}
</div>
