{# Template for Hearing teaser extending base-card #}

{% extends 'themes/custom/hoeringsportal/templates/components/base-card.html.twig' %}

{# Set the content state #}
{% set content_state = hearing_helper.getState(node) %}

{# Set how many replies there is to this hearing #}
{% set repliesCount = hearing_helper.getNumberOfReplies(node) %}

{# Set startdate for hearing #}
{% set startdate = hearing_helper.getStartDate(node) %}

{# Set deadlinedate for hearing #}
{% set deadlinedate = hearing_helper.getDeadlineDate(node) %}

{# Set is deadlinepassed #}
{% set deadlinepassed = hearing_helper.isDeadlinePassed(node) %}

{# Show a date splash on the card #}
{% block card_date %}
  {# If we have a date then show a date splash on the card #}
  {% if (content_state in ['upcoming', 'active']) %}
    {# Show the date #}
      <div class="fw-semibold">{{ deadlinedate|format_date('hoeringsportal_day_only') }}</div>
      <div class="small">{{ deadlinedate|format_date('hoeringsportal_month_short') }}</div>
  {% elseif (content_state in ['finished']) %}
    <div><strong>{{ 'Ended'|t }}</strong></div>
  {% elseif (content_state in ['canceled']) %}
    <div>{{ 'Canceled'|t }}</div>
  {% endif %}
{% endblock %}

{# Show teaser description #}
{% block card_content %}
  {{ content.field_teaser[0]['#context'].value|truncate(95, true, true) }}
{% endblock %}

{# Collect data for information lines on card #}
{% set items =
  [
    {icon: 'fa-calendar-day', value: deadlinepassed ? 'Hearing has ended'|t : deadlinedate|format_date('hoeringsportal_date_long')|capitalize },
    {icon: 'fa-comments', value: repliesCount ~ ' ' ~ 'replies'|t},
    {icon: 'fa-location-dot', value: content.field_area}
  ]
%}

{# Show card information #}
{% block card_type_information %}
  {# Show details for next Hearing #}
  {% if (content_state in ['upcoming', 'active', 'finished']) %}
    {% for item in items %}
      <div class="d-flex gap-3 justify-items-center {% if not loop.last %} border-bottom {% endif %}">
        <i class="fa-solid fa-fw fa-lg {{ item.icon }} text-hearing"></i>
        <p class="small">{{ item.value }}</p>
      </div>
    {% endfor %}
  {# Show text for canceled Hearing #}
  {% elseif (content_state == 'canceled') %}
    <p>{{ 'Hearing has been canceled'|t }}</p>
  {% endif %}
{% endblock %}
